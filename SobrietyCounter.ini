[Rainmeter]
; 30ms update = Smooth animation
Update=30
AccurateText=1
SkinWidth=210
SkinHeight=50
BackgroundMode=2
SolidColor=0,0,0,1

[Metadata]
Name=Illustro Sobriety (Visible Fix)
Author=Velvin Nazareth
Information=Fixed visibility issues. Animated & OLED Safe.
Version=9.0

[Variables]
; --- DATES ---
StartDate=2025-12-15
GoalDate=2026-01-18

; --- VISUALS ---
fontName=Trebuchet MS
BaseColorBar=235,170,0
BaseColorText=255,255,255

; --- PIXEL SHIFT VARIABLES ---
; These variables will automatically change to move the widget
ShiftX=0
ShiftY=0

; ----------------------------------
; ANIMATION & LOGIC
; ----------------------------------

; 1. HEARTBEAT PULSE
[MeasurePulse]
Measure=Calc
Formula=160 + (95 * Sin((Counter % 100) / 100 * 2 * PI))
DynamicVariables=1

; 2. PIXEL SHIFTER (Calculates the random offset)
[MeasureRandomShift]
Measure=Calc
Formula=Random
LowBound=0
HighBound=2
; Updates every 60 seconds (approx)
UpdateDivider=2000
; Updates the ShiftX and ShiftY variables, then redraws the skin
OnUpdateAction=[!SetVariable ShiftX "[MeasureRandomShift]"][!SetVariable ShiftY "[MeasureRandomShift]"]

; 3. DATE MATH (Optimized)
[MeasureNow]
Measure=Time
UpdateDivider=30

[MeasureStart]
Measure=Time
TimeStamp=#StartDate#
TimeStampFormat=%Y-%m-%d
UpdateDivider=30

[MeasureGoal]
Measure=Time
TimeStamp=#GoalDate#
TimeStampFormat=%Y-%m-%d
UpdateDivider=30

[MeasureDaysClean]
Measure=Calc
Formula=Floor(([MeasureNow:TimeStamp] - [MeasureStart:TimeStamp]) / 86400) + 1
DynamicVariables=1
UpdateDivider=30

[MeasurePercent]
Measure=Calc
Formula=([MeasureDaysClean] / Floor(([MeasureGoal:TimeStamp] - [MeasureStart:TimeStamp]) / 86400)) * 100
MinValue=0
MaxValue=100
DynamicVariables=1
UpdateDivider=30

; ----------------------------------
; METERS (VISIBLE)
; ----------------------------------

; 1. ANIMATED BAR
[MeterBarFill]
Meter=Bar
MeasureName=MeasurePercent
; X position = 0 + The Random Shift
X=(0 + #ShiftX#)
; Y position = 37 + The Random Shift
Y=(37 + #ShiftY#)
W=200
H=3
BarColor=#BaseColorBar#,[MeasurePulse]
BarOrientation=Horizontal
DynamicVariables=1

; 2. ANIMATED TEXT
[MeterText]
Meter=String
MeasureName=MeasureDaysClean
MeasureName2=MeasurePercent
Text="%1 Days Clean"
; X position = 100 (Center) + The Random Shift
X=(100 + #ShiftX#)
; Y position = 20 (Middle) + The Random Shift
Y=(20 + #ShiftY#)
StringAlign=CenterCenter
FontColor=#BaseColorText#
FontFace=#fontName#
FontSize=17
FontWeight=950
AntiAlias=1
StringEffect=Shadow
FontEffectColor=0,0,0,180
ToolTipText="Start: #StartDate# | Goal: #GoalDate# (Progress: %2%)"
DynamicVariables=1